{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"\ud83d\udee1 Forge Guardian","text":"<p>Hack detection &amp; auto-healing for Laravel Forge servers.</p> <p></p> <p>Catches injected <code>cache.php</code> backdoors, obfuscated shells, tampered files, and suspicious cron jobs \u2014 then quarantines them and restores your repo to a clean state. Built for DigitalOcean + Laravel Forge, works on any server with git-managed Laravel projects.</p>"},{"location":"#the-problem","title":"The Problem","text":"<p>Laravel Forge servers are a common target. Attackers inject files like <code>cache.php</code>, <code>config2.php</code>, or <code>debug.php</code> containing obfuscated <code>eval(base64_decode(...))</code> payloads. These backdoors hide in your <code>public/</code> folder, storage directories, or alongside your app code. By the time you notice, they've been there for days.</p>"},{"location":"#the-solution","title":"The Solution","text":"<p>Forge Guardian runs every 5 minutes via cron and checks:</p> Detector What it catches Git status Any untracked file not in <code>.gitignore</code> or the allowlist \u2014 the #1 sign of injected backdoors Webroot scan <code>.php</code> files in <code>public/</code> that aren't <code>index.php</code> Malicious signatures <code>eval(base64_decode(</code>, <code>shell_exec($</code>, obfuscated hex, <code>$_REQUEST</code> injections, etc. Recent changes PHP files modified in the last 10 minutes containing malicious code Suspicious crons Cron entries with <code>curl</code> pipes, <code>wget</code>, reverse shells Bad permissions World-writable directories, loose <code>.env</code> permissions <p>When threats are found, it can auto-heal \u2014 quarantine malicious files (preserved for forensics) and <code>git checkout</code> tampered tracked files back to their clean state.</p>"},{"location":"#quick-start","title":"Quick Start","text":""},{"location":"#one-liner-install-on-the-server","title":"One-liner install (on the server)","text":"<pre><code>curl -sL https://raw.githubusercontent.com/YOUR_USER/forge-guardian/main/install.sh | sudo bash\n</code></pre> <p>This auto-detects all Laravel projects in <code>/home/forge/</code>, installs the script, and runs an initial scan.</p>"},{"location":"#remote-deploy-from-your-local-machine","title":"Remote deploy (from your local machine)","text":"<p>Deploy to multiple servers at once over SSH without logging into each one:</p> <pre><code>git clone https://github.com/YOUR_USER/forge-guardian.git\ncd forge-guardian\n\n# Single server\n./deploy-remote.sh 142.93.1.100\n\n# Multiple servers with Slack alerts and auto-heal\n./deploy-remote.sh \\\n    --servers examples/servers.txt \\\n    --slack \"https://hooks.slack.com/services/T00/B00/xxx\" \\\n    --mode auto-heal \\\n    142.93.1.100 167.99.2.200\n\n# Custom SSH key (typical for Forge)\n./deploy-remote.sh --key ~/.ssh/forge_rsa 142.93.1.100\n</code></pre> <p>The remote deployer will: 1. SSH into each server 2. Upload <code>forge-guardian.sh</code> 3. Auto-detect all git-based Laravel projects in <code>/home/forge/</code> 4. Configure your notification webhooks 5. Install the cron job + log rotation 6. Run an initial dry-run scan so you see results immediately</p>"},{"location":"#manual-install","title":"Manual install","text":"<pre><code>sudo mkdir -p /opt/forge-guardian\nsudo curl -fsSL https://raw.githubusercontent.com/YOUR_USER/forge-guardian/main/forge-guardian.sh \\\n    -o /opt/forge-guardian/forge-guardian.sh\nsudo chmod +x /opt/forge-guardian/forge-guardian.sh\n\n# Edit config \u2014 set your project directories and notifications\nsudo nano /opt/forge-guardian/forge-guardian.sh\n\n# Test\nsudo /opt/forge-guardian/forge-guardian.sh --dry-run --verbose\n\n# Add to cron (every 5 minutes)\n(sudo crontab -l 2&gt;/dev/null | grep -v forge-guardian; \\\n echo '*/5 * * * * /opt/forge-guardian/forge-guardian.sh --auto-heal &gt;&gt; /var/log/forge-guardian.log 2&gt;&amp;1') \\\n | sudo crontab -\n</code></pre>"},{"location":"#usage","title":"Usage","text":"<pre><code>forge-guardian.sh [FLAGS]\n\nFLAGS:\n    --dry-run       Report what would happen, take no action\n    --auto-heal     Quarantine malicious files, git-restore tampered ones\n    --verbose       Extra debug output\n    (no flags)      Detect and report only\n</code></pre>"},{"location":"#auto-heal-behavior","title":"Auto-Heal Behavior","text":"File type Action Untracked malicious file Moved to <code>/opt/forge-guardian/quarantine/&lt;run_id&gt;/</code> Tampered tracked file Backed up to quarantine, then restored via <code>git checkout</code> <p>Nothing is permanently deleted by default. Set <code>HEAL_MODE=\"delete\"</code> in the config to skip quarantine.</p>"},{"location":"#remote-deploy-options","title":"Remote Deploy Options","text":"<pre><code>deploy-remote.sh [OPTIONS] server1 server2 ...\n\nOPTIONS:\n    --user &lt;user&gt;              SSH user (default: root)\n    --key &lt;path&gt;               SSH private key (default: ~/.ssh/id_rsa)\n    --port &lt;port&gt;              SSH port (default: 22)\n    --servers &lt;file&gt;           File with one server per line\n    --projects &lt;dirs&gt;          Comma-separated project dirs (default: auto-detect)\n    --slack &lt;url&gt;              Slack webhook URL\n    --discord &lt;url&gt;            Discord webhook URL\n    --telegram &lt;token:chatid&gt;  Telegram bot token and chat ID\n    --email &lt;address&gt;          Email notifications (requires mailutils)\n    --mode &lt;mode&gt;              \"detect-only\" (default) or \"auto-heal\"\n    --interval &lt;min&gt;           Cron interval in minutes (default: 5)\n    --uninstall                Remove Forge Guardian from target servers\n    --dry-run                  Preview without executing\n</code></pre>"},{"location":"#notifications","title":"Notifications","text":"<p>Configure any combination \u2014 alerts only fire when threats are found.</p> Channel Config variable Setup Slack <code>SLACK_WEBHOOK_URL</code> Create incoming webhook Discord <code>DISCORD_WEBHOOK_URL</code> Server Settings \u2192 Integrations \u2192 Webhooks Telegram <code>TELEGRAM_BOT_TOKEN</code> + <code>TELEGRAM_CHAT_ID</code> @BotFather Email <code>NOTIFICATION_EMAIL</code> Requires <code>mailutils</code> installed on server <p>When deploying remotely, pass these via flags: <pre><code>./deploy-remote.sh --slack \"https://hooks.slack.com/...\" 142.93.1.100\n</code></pre></p>"},{"location":"#configuration","title":"Configuration","text":"<p>The top of <code>forge-guardian.sh</code> contains all configurable options:</p> <pre><code># Project directories to monitor\nPROJECT_DIRS=(\n    \"/home/forge/example.com\"\n    \"/home/forge/another-site.com\"\n)\n\n# Paths that are OK to be untracked (beyond .gitignore)\nALLOWLIST=(\n    \"storage/framework/cache/*\"\n    \"storage/framework/sessions/*\"\n    \"storage/logs/*\"\n    \"vendor/*\"\n    \"node_modules/*\"\n    # ... etc\n)\n\n# Heal mode: \"quarantine\" (default, keeps files) or \"delete\"\nHEAL_MODE=\"quarantine\"\n</code></pre>"},{"location":"#adding-custom-suspicious-patterns","title":"Adding Custom Suspicious Patterns","text":"<pre><code>SUSPICIOUS_PATTERNS=(\n    'cache[0-9]*\\.php'     # cache1.php, cache23.php\n    'wp-.*\\.php'           # WordPress-style backdoors\n    'shell\\.php'\n    # Add your own:\n    'backdoor\\.php'\n)\n</code></pre>"},{"location":"#adding-custom-malicious-signatures","title":"Adding Custom Malicious Signatures","text":"<pre><code>MALICIOUS_SIGNATURES=(\n    'eval\\s*(\\s*base64_decode'\n    'shell_exec\\s*('\n    # Add your own:\n    'some_known_malware_string'\n)\n</code></pre>"},{"location":"#hardening-your-forge-servers","title":"Hardening Your Forge Servers","text":"<p>If you're getting hacked repeatedly, Forge Guardian is a safety net \u2014 but you should also close the attack vectors. The most common ones:</p>"},{"location":"#1-disable-dangerous-php-functions","title":"1. Disable dangerous PHP functions","text":"<p>Add to your <code>php.ini</code> (or via Forge \u2192 Server \u2192 PHP Settings):</p> <pre><code>disable_functions = exec,passthru,shell_exec,system,proc_open,popen\n</code></pre> <p>Note: Laravel queues need <code>proc_open</code>. Test before applying in production, or use <code>pcntl_exec</code> restrictions instead.</p>"},{"location":"#2-lock-down-file-permissions","title":"2. Lock down file permissions","text":"<pre><code># All project files owned by forge:forge\nsudo chown -R forge:forge /home/forge/example.com\n\n# Directories: 755, Files: 644\nsudo find /home/forge/example.com -type d -exec chmod 755 {} \\;\nsudo find /home/forge/example.com -type f -exec chmod 644 {} \\;\n\n# Storage and cache need to be writable\nsudo chmod -R 775 /home/forge/example.com/storage\nsudo chmod -R 775 /home/forge/example.com/bootstrap/cache\n\n# .env should be restricted\nsudo chmod 600 /home/forge/example.com/.env\n</code></pre>"},{"location":"#3-block-dotfiles-and-php-in-uploads-via-nginx","title":"3. Block dotfiles and PHP in uploads via Nginx","text":"<p>Add to your Nginx server block (Forge \u2192 Site \u2192 Nginx Config):</p> <pre><code># Block access to dotfiles\nlocation ~ /\\. {\n    deny all;\n    access_log off;\n    log_not_found off;\n}\n\n# Block PHP execution in storage/uploads\nlocation ~* /storage/.*\\.php$ {\n    deny all;\n}\n</code></pre>"},{"location":"#4-check-for-unauthorized-ssh-keys","title":"4. Check for unauthorized SSH keys","text":"<pre><code>cat ~/.ssh/authorized_keys\ncat /home/forge/.ssh/authorized_keys\n# Remove any keys you don't recognize\n</code></pre>"},{"location":"#5-audit-forge-deploy-scripts","title":"5. Audit Forge deploy scripts","text":"<p>Check Forge \u2192 Site \u2192 Deploy Script for any injected commands (curl pipes, wget, etc).</p>"},{"location":"#6-keep-everything-updated","title":"6. Keep everything updated","text":"<pre><code>composer audit                    # Check for known vulnerabilities\nsudo apt update &amp;&amp; sudo apt upgrade  # OS patches\n# Update PHP via Forge UI\n</code></pre>"},{"location":"#7-production-basics","title":"7. Production basics","text":"<pre><code>APP_DEBUG=false\nAPP_ENV=production\n</code></pre>"},{"location":"#log-rotation","title":"Log Rotation","text":"<p>Installed automatically by the remote deployer and one-liner installer. For manual installs, add to <code>/etc/logrotate.d/forge-guardian</code>:</p> <pre><code>/var/log/forge-guardian.log {\n    weekly\n    rotate 12\n    compress\n    missingok\n    notifempty\n}\n</code></pre>"},{"location":"#file-structure","title":"File Structure","text":"<pre><code>forge-guardian/\n\u251c\u2500\u2500 forge-guardian.sh     # Main detection &amp; healing script (runs on server)\n\u251c\u2500\u2500 deploy-remote.sh      # Deploy to servers over SSH (runs locally)\n\u251c\u2500\u2500 install.sh            # One-liner curl installer (runs on server)\n\u251c\u2500\u2500 examples/\n\u2502   \u2514\u2500\u2500 servers.txt       # Example servers list file\n\u251c\u2500\u2500 LICENSE\n\u2514\u2500\u2500 README.md\n</code></pre>"},{"location":"#uninstall","title":"Uninstall","text":"<pre><code># Via remote deployer\n./deploy-remote.sh --uninstall 142.93.1.100\n\n# Or manually on the server\n(sudo crontab -l | grep -v forge-guardian) | sudo crontab -\nsudo rm -rf /opt/forge-guardian\nsudo rm -f /etc/logrotate.d/forge-guardian\n# Log preserved at /var/log/forge-guardian.log\n</code></pre> <p>Quarantined files are preserved during uninstall for forensic review.</p>"},{"location":"#license","title":"License","text":"<p>MIT \u2014 see LICENSE.</p>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/","title":"PRP: Implement Forge Guardian in Bashew Framework","text":""},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#goal","title":"Goal","text":"<p>Rewrite the functionality from three original scripts (<code>original/forge-guardian.sh</code>, <code>original/deploy-remote.sh</code>, <code>original/install.sh</code>) into a single bashew-based script (<code>forge-guardian.sh</code>) with three main verbs:</p> <ol> <li><code>scan</code> \u2014 Run security checks on all Laravel/Forge projects (auto-detected via <code>find $root -type d -name .git</code>)</li> <li><code>install</code> \u2014 Local installation on a Forge server (cron, logrotate, permissions)</li> <li><code>deploy</code> \u2014 Remote installation over SSH to one or more servers (KeyFile auth)</li> </ol> <p>Plus supporting verbs: <code>uninstall</code>, <code>check</code>, <code>env</code>, <code>update</code>.</p>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#why","title":"Why","text":"<ul> <li>Consolidation: Three separate scripts become one tool with clear verbs</li> <li>Bashew framework: Proper CLI parsing, .env support, logging, help text, update mechanism</li> <li>Auto-detection: Projects discovered via filesystem scan instead of hardcoded arrays</li> <li>Security: Detect injected backdoors, obfuscated shells, tampered files, suspicious crons on Laravel Forge servers</li> </ul>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#what","title":"What","text":""},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#user-visible-behavior","title":"User-visible behavior","text":"<pre><code># On local machine - deploy to remote servers\nforge-guardian.sh deploy -s 142.93.1.100 -s 167.99.2.200\nforge-guardian.sh deploy --servers servers.txt --slack \"https://hooks.slack.com/...\"\n\n# On server - install locally (sets up cron + logrotate)\nsudo forge-guardian.sh install\n\n# On server - run security scan (called by cron)\nforge-guardian.sh scan\nforge-guardian.sh scan --mode heal     # auto-heal threats\nforge-guardian.sh scan --mode dryrun   # show what heal would do\n\n# On server - remove\nsudo forge-guardian.sh uninstall\n</code></pre>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#success-criteria","title":"Success Criteria","text":"<ul> <li> <code>forge-guardian.sh scan</code> auto-detects projects under <code>$root/</code> and runs all 5 detectors</li> <li> <code>forge-guardian.sh scan --mode heal</code> quarantines malicious files and git-restores tampered tracked files</li> <li> <code>forge-guardian.sh install</code> copies itself to <code>/opt/forge-guardian/</code>, sets up cron and logrotate</li> <li> <code>forge-guardian.sh deploy -s &lt;server&gt;</code> uploads script via SCP, runs remote install via SSH</li> <li> <code>forge-guardian.sh deploy --servers &lt;file&gt;</code> reads servers from file</li> <li> Notifications (Slack, Discord, Telegram, Email) fire when threats are found</li> <li> All config can be set via .env file OR CLI options</li> <li> <code>forge-guardian.sh check</code> shows current config values</li> <li> <code>bash -n forge-guardian.sh</code> passes</li> <li> <code>shellcheck forge-guardian.sh</code> passes (with acceptable SC directives)</li> </ul>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#all-needed-context","title":"All Needed Context","text":""},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#documentation-references","title":"Documentation &amp; References","text":"<pre><code>- file: forge-guardian.sh\n  why: \"Target file - bashew template with framework code below line 172. Edit ONLY above line 172.\"\n\n- file: original/forge-guardian.sh\n  why: \"Source for scan logic: 5 detectors, malicious signatures, suspicious patterns, allowlist, quarantine, notifications\"\n\n- file: original/deploy-remote.sh\n  why: \"Source for deploy logic: SSH/SCP helpers, remote install script builder, server list parsing\"\n\n- file: original/install.sh\n  why: \"Source for install logic: auto-detect projects, cron setup, logrotate config\"\n\n- file: original/examples/servers.txt\n  why: \"Example servers file format (one per line, # comments)\"\n\n- file: README.md\n  why: \"Documents expected behavior, all CLI flags, notification setup, hardening recommendations\"\n</code></pre>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#current-codebase-tree","title":"Current Codebase Tree","text":"<pre><code>forge-guardian/\n\u251c\u2500\u2500 forge-guardian.sh          # Bashew template (TARGET - edit this)\n\u251c\u2500\u2500 original/\n\u2502   \u251c\u2500\u2500 forge-guardian.sh      # Reference: scan/detection logic\n\u2502   \u251c\u2500\u2500 deploy-remote.sh       # Reference: SSH deploy logic\n\u2502   \u251c\u2500\u2500 install.sh             # Reference: local install logic\n\u2502   \u2514\u2500\u2500 examples/\n\u2502       \u2514\u2500\u2500 servers.txt        # Example server list\n\u251c\u2500\u2500 .env                       # Empty (will hold config)\n\u251c\u2500\u2500 .env.example               # Empty (will define all vars)\n\u251c\u2500\u2500 VERSION.md                 # 0.0.0\n\u251c\u2500\u2500 README.md                  # Full documentation\n\u2514\u2500\u2500 LICENSE                    # MIT\n</code></pre>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#desired-codebase-tree","title":"Desired Codebase Tree","text":"<pre><code>forge-guardian/\n\u251c\u2500\u2500 forge-guardian.sh          # MODIFIED: full implementation with all verbs\n\u251c\u2500\u2500 .env.example               # MODIFIED: all notification/config vars documented\n\u251c\u2500\u2500 original/                  # UNCHANGED: reference only\n\u2502   \u251c\u2500\u2500 forge-guardian.sh\n\u2502   \u251c\u2500\u2500 deploy-remote.sh\n\u2502   \u251c\u2500\u2500 install.sh\n\u2502   \u2514\u2500\u2500 examples/\n\u2502       \u2514\u2500\u2500 servers.txt\n\u251c\u2500\u2500 .env                       # User config (gitignored)\n\u251c\u2500\u2500 VERSION.md\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 LICENSE\n</code></pre>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#known-gotchas-framework-quirks","title":"Known Gotchas &amp; Framework Quirks","text":"<pre><code># CRITICAL: Only edit ABOVE line 172 (\"DO NOT MODIFY BELOW THIS LINE\")\n# The bashew framework code below that line handles all parsing, initialization, etc.\n\n# CRITICAL: run_as_root must be changed from -1 to 0\n# Original: run_as_root=-1 (MAY NOT run as root)\n# Needed:   run_as_root=0  (don't check - scan/install need root, deploy doesn't)\n\n# CRITICAL: grep -P (PCRE) is NOT available on macOS\n# The original uses grep -qPi for malicious signatures\n# On macOS (dev), this fails. On Linux (production), it works.\n# Use Os:require \"grep\" and document that scanning needs GNU grep on Linux servers\n\n# CRITICAL: stat command differs between macOS and Linux\n# macOS: stat -f%z (file size), stat -f \"%OLp\" (permissions)\n# Linux: stat --printf=\"%s\" (file size), stat -c \"%a\" (permissions)\n# The original handles both - preserve this pattern\n\n# CRITICAL: bashew uses IFS=$'\\n\\t' - this is stricter than the original\n# Be careful with word splitting in arrays and loops\n\n# IMPORTANT: bashew auto-loads .env files from multiple locations\n# This is perfect for notification config - user puts slack=https://... in .env\n# Variable names from Option:config become .env keys (lowercase long names)\n\n# IMPORTANT: The choice validator in bashew is case-sensitive for the list\n# but Script:main() uses ${action,,} for matching - keep verb names lowercase\n\n# IMPORTANT: list type options use -x &lt;val&gt; -x &lt;val2&gt; syntax\n# list|s|server|server to deploy to =&gt; ${server[@]} array\n# Usage: forge-guardian.sh deploy -s host1 -s host2\n</code></pre>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#implementation-blueprint","title":"Implementation Blueprint","text":""},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#optionconfig-design","title":"Option:config() Design","text":"<pre><code>function Option:config() {\n  grep &lt;&lt;&lt;'\n#commented lines will be filtered\nflag|h|help|show usage\nflag|Q|QUIET|no output\nflag|V|VERBOSE|also show debug messages\nflag|f|FORCE|do not ask for confirmation (always yes)\noption|L|LOG_DIR|folder for log files|$HOME/log/$script_prefix\noption|T|TMP_DIR|folder for temp files|/tmp/$script_prefix\noption|u|user|SSH user for deploy|root\noption|k|key|SSH private key path|$HOME/.ssh/id_rsa\noption|p|port|SSH port|22\noption|S|servers|file with server list\noption|w|slack|Slack webhook URL\noption|D|discord|Discord webhook URL\noption|G|telegram|Telegram config (bot_token:chat_id)\noption|e|email|notification email address\noption|m|mode|scan mode: detect/heal/dryrun|detect\noption|i|interval|cron interval in minutes|5\noption|r|root|root folder for Forge projects|$root\noption|q|quarantine|quarantine directory|/opt/forge-guardian/quarantine\nlist|s|server|server to deploy to\nchoice|1|action|action to perform|scan,install,deploy,uninstall,check,env,update\n' -v -e '^#' -e '^\\s*$'\n}\n</code></pre> <p>Variable mapping:</p> Option Variable Default Used by <code>--user</code> <code>$user</code> <code>root</code> deploy <code>--key</code> <code>$key</code> <code>~/.ssh/id_rsa</code> deploy <code>--port</code> <code>$port</code> <code>22</code> deploy <code>--servers</code> <code>$servers</code> `` deploy (file) <code>--server</code> (list) <code>${server[@]}</code> <code>()</code> deploy (CLI) <code>--slack</code> <code>$slack</code> `` scan, deploy <code>--discord</code> <code>$discord</code> `` scan, deploy <code>--telegram</code> <code>$telegram</code> `` scan, deploy <code>--email</code> <code>$email</code> `` scan, deploy <code>--mode</code> <code>$mode</code> <code>detect</code> scan, deploy <code>--interval</code> <code>$interval</code> <code>5</code> install, deploy <code>--root</code> <code>$root</code> <code>/home/forge</code> scan, install <code>--quarantine</code> <code>$quarantine</code> <code>/opt/forge-guardian/quarantine</code> scan"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#envexample-design","title":".env.example Design","text":"<pre><code># Forge Guardian Configuration\n# Copy to .env and fill in your values\n\n# Notification webhooks (leave empty to disable)\nslack=\"\"\ndiscord=\"\"\ntelegram=\"\"\nemail=\"\"\n\n# Root folder for Forge projects (auto-detect git repos under this path)\nroot=\"/home/forge\"\n\n# Scan mode: detect (report only) / heal (quarantine + restore) / dryrun (show what heal would do)\nmode=\"detect\"\n\n# SSH settings for remote deploy\nuser=\"root\"\nkey=\"$HOME/.ssh/id_rsa\"\nport=\"22\"\n\n# Cron interval in minutes\ninterval=\"5\"\n\n# Quarantine directory for healed files\nquarantine=\"/opt/forge-guardian/quarantine\"\n</code></pre>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#constant-data-embedded-in-script","title":"Constant Data (embedded in script)","text":"<p>Port these arrays from <code>original/forge-guardian.sh</code>: - <code>ALLOWLIST</code> array (lines 50-63) - <code>SUSPICIOUS_PATTERNS</code> array (lines 66-80) - <code>MALICIOUS_SIGNATURES</code> array (lines 83-104)</p> <p>These are readonly arrays defined at the top of the helper functions section.</p>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#scriptmain-dispatch","title":"Script:main() Dispatch","text":"<pre><code>function Script:main() {\n  IO:log \"[$script_basename] $script_version started\"\n  case \"${action,,}\" in\n  scan)     do_scan ;;\n  install)  do_install ;;\n  deploy)   do_deploy ;;\n  uninstall) do_uninstall ;;\n  check|env) Script:check ;;\n  update)   Script:git_pull ;;\n  *)        IO:die \"action [$action] not recognized\" ;;\n  esac\n  IO:log \"[$script_basename] ended after $SECONDS secs\"\n}\n</code></pre>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#task-list-in-execution-order","title":"Task List (in execution order)","text":""},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#task-1-update-script-metadata-and-optionconfig","title":"Task 1: Update script metadata and Option:config()","text":"<pre><code>MODIFY forge-guardian.sh:\n  - CHANGE run_as_root from -1 to 0\n  - REPLACE Option:config() with full flag/option/list/choice definitions\n  - REPLACE Script:main() with verb dispatch to do_scan, do_install, do_deploy, do_uninstall\n  - REMOVE placeholder do_action1() and do_action2() functions\n  - ADD TIP comments for each verb\n</code></pre> <p>Pseudocode: <pre><code># Change line 61:\nreadonly run_as_root=0  # 0 = don't check (scan/install need root, deploy doesn't)\n\n# Option:config() as designed above\n\n# Script:main() as designed above\n</code></pre></p>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#task-2-define-constant-arrays-scan-patterns","title":"Task 2: Define constant arrays (scan patterns)","text":"<pre><code>ADD after Script:main() closing brace:\n  - DEFINE readonly ALLOWLIST array (from original/forge-guardian.sh lines 50-63)\n  - DEFINE readonly SUSPICIOUS_PATTERNS array (from original lines 66-80)\n  - DEFINE readonly MALICIOUS_SIGNATURES array (from original lines 83-104)\n</code></pre> <p>Pseudocode: <pre><code># These are constant arrays used by the scan detectors\n# Ported from original/forge-guardian.sh\n\nreadonly -a FG_ALLOWLIST=(\n    \"storage/framework/cache/*\"\n    \"storage/framework/sessions/*\"\n    \"storage/framework/views/*\"\n    \"storage/logs/*\"\n    \"storage/app/*\"\n    \"bootstrap/cache/*\"\n    \".env\"\n    \"vendor/*\"\n    \"node_modules/*\"\n    \"public/build/*\"\n    \"public/hot\"\n    \"public/storage\"\n)\n\nreadonly -a FG_SUSPICIOUS_PATTERNS=(\n    'cache[0-9]*\\.php'\n    'config[0-9]*\\.php'\n    # ... (all from original lines 67-79)\n)\n\nreadonly -a FG_MALICIOUS_SIGNATURES=(\n    'eval\\s*(\\s*base64_decode'\n    'eval\\s*(\\s*gzinflate'\n    # ... (all from original lines 84-103)\n)\n</code></pre></p>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#task-3-implement-scan-helper-functions","title":"Task 3: Implement scan helper functions","text":"<pre><code>ADD helper functions:\n  - is_allowlisted() - check path against FG_ALLOWLIST (from original lines 162-171)\n  - scan_file_content() - grep for malicious signatures (from original lines 174-199)\n  - is_suspicious_filename() - check against FG_SUSPICIOUS_PATTERNS (from original lines 202-211)\n  - quarantine_file() - move file preserving dir structure (from original lines 214-232)\n  - git_restore_file() - git checkout tracked file (from original lines 235-248)\n  - remove_untracked() - quarantine or delete untracked file (from original lines 251-265)\n</code></pre> <p>Key adaptations for bashew: <pre><code>function is_allowlisted() {\n    local filepath=\"$1\"\n    for pattern in \"${FG_ALLOWLIST[@]}\"; do\n        # shellcheck disable=SC2254\n        case \"$filepath\" in\n            $pattern) return 0 ;;\n        esac\n    done\n    return 1\n}\n\nfunction scan_file_content() {\n    local filepath=\"$1\"\n    # Skip non-PHP files\n    [[ ! \"$filepath\" =~ \\.(php|phtml|pht|php[0-9]|inc)$ ]] &amp;&amp; return 1\n    # Skip files &gt; 5MB\n    local filesize\n    filesize=$(stat -f%z \"$filepath\" 2&gt;/dev/null || stat --printf=\"%s\" \"$filepath\" 2&gt;/dev/null || echo \"0\")\n    (( filesize &gt; 5242880 )) &amp;&amp; return 1\n\n    for sig in \"${FG_MALICIOUS_SIGNATURES[@]}\"; do\n        if grep -qPi \"$sig\" \"$filepath\" 2&gt;/dev/null; then\n            IO:alert \"MALICIOUS SIGNATURE in $filepath: matches '$sig'\"\n            return 0\n        fi\n    done\n    return 1\n}\n\nfunction quarantine_file() {\n    local filepath=\"$1\"\n    local project_dir=\"$2\"\n    local run_id\n    run_id=$(date '+%Y%m%d_%H%M%S')_$$\n    local relative_path=\"${filepath#$project_dir/}\"\n    local quarantine_path=\"${quarantine}/${run_id}/${project_dir##*/}/${relative_path}\"\n\n    mkdir -p \"$(dirname \"$quarantine_path\")\"\n\n    if [[ \"$mode\" == \"dryrun\" ]]; then\n        IO:print \"[DRY-RUN] Would quarantine: $filepath -&gt; $quarantine_path\"\n        return\n    fi\n    cp -p \"$filepath\" \"$quarantine_path\" 2&gt;/dev/null || true\n    rm -f \"$filepath\"\n    IO:alert \"QUARANTINED: $filepath -&gt; $quarantine_path\"\n}\n\nfunction git_restore_file() {\n    local filepath=\"$1\"\n    local project_dir=\"$2\"\n    if [[ \"$mode\" == \"dryrun\" ]]; then\n        IO:print \"[DRY-RUN] Would git restore: $filepath\"\n        return\n    fi\n    (cd \"$project_dir\" &amp;&amp; git checkout -- \"$filepath\" 2&gt;/dev/null) &amp;&amp; \\\n        IO:success \"RESTORED from git: $filepath\" || \\\n        IO:alert \"Failed to git-restore: $filepath\"\n}\n</code></pre></p>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#task-4-implement-detection-functions","title":"Task 4: Implement detection functions","text":"<pre><code>ADD detection functions (ported from original/forge-guardian.sh):\n  - detect_git_anomalies()      - lines 310-394 of original\n  - detect_webroot_injections() - lines 399-448 of original\n  - detect_recent_changes()     - lines 453-487 of original\n  - detect_suspicious_crons()   - lines 492-522 of original\n  - detect_bad_permissions()    - lines 527-549 of original\n</code></pre> <p>Key adaptations for bashew: <pre><code># Replace echo/alert/warn/log with IO:print/IO:alert/IO:debug\n# Replace $DRY_RUN/$AUTO_HEAL with $mode checks:\n#   \"detect\" = report only\n#   \"heal\"   = quarantine + restore\n#   \"dryrun\" = report what would be done\n# Replace direct ((THREATS_FOUND++)) with function return + caller tracking\n# Use IO:debug for verbose output instead of custom log_verbose\n</code></pre></p> <p>Each detector takes <code>$project_dir</code> as argument and returns the number of threats found. The caller accumulates the total.</p>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#task-5-implement-notification-function","title":"Task 5: Implement notification function","text":"<pre><code>ADD send_notifications() function:\n  - Slack via curl (from original lines 274-279)\n  - Discord via curl (from original lines 282-287)\n  - Email via mail command (from original lines 290-293)\n  - Telegram via curl (from original lines 296-304)\n  - Use $slack, $discord, $email, $telegram variables from Option:config\n  - For telegram: split on \":\" to get bot_token and chat_id\n</code></pre> <p>Pseudocode: <pre><code>function send_notifications() {\n    local message=\"$1\"\n    local hostname\n    hostname=$(hostname)\n\n    if [[ -n \"${slack:-}\" ]]; then\n        IO:debug \"Sending Slack notification\"\n        curl -s -X POST -H 'Content-type: application/json' \\\n            --data \"{\\\"text\\\":\\\"Forge Guardian Alert - ${hostname}\\n\\n${message}\\\"}\" \\\n            \"$slack\" &gt; /dev/null 2&gt;&amp;1 || true\n    fi\n    # ... discord, email, telegram similarly\n}\n</code></pre></p>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#task-6-implement-do_scan","title":"Task 6: Implement do_scan()","text":"<pre><code>ADD do_scan() function:\n  - Auto-detect projects: find $root -maxdepth 2 -type d -name .git\n  - Extract parent dir of each .git to get project dirs\n  - For each project: run all 5 detectors\n  - Accumulate threats_found count\n  - If threats &gt; 0: send notifications, exit 1\n  - If clean: IO:success \"All clear\", exit 0\n</code></pre> <p>Pseudocode: <pre><code>function do_scan() {\n    Os:require \"git\"\n    Os:require \"grep\"\n\n    IO:print \"Forge Guardian Scan - Mode: $mode\"\n\n    # Auto-detect projects\n    local -a project_dirs=()\n    while IFS= read -r -d '' gitdir; do\n        project_dirs+=(\"$(dirname \"$gitdir\")\")\n    done &lt; &lt;(find $root -maxdepth 2 -type d -name .git -print0 2&gt;/dev/null)\n\n    if [[ ${#project_dirs[@]} -eq 0 ]]; then\n        IO:alert \"No git projects found under $root/\"\n        return 1\n    fi\n\n    IO:print \"Found ${#project_dirs[@]} project(s)\"\n\n    local threats_found=0\n    mkdir -p \"$quarantine\"\n\n    for dir in \"${project_dirs[@]}\"; do\n        IO:print \"Project: $dir\"\n        threats_found=$((threats_found + $(detect_git_anomalies \"$dir\")))\n        threats_found=$((threats_found + $(detect_webroot_injections \"$dir\")))\n        threats_found=$((threats_found + $(detect_recent_changes \"$dir\")))\n        threats_found=$((threats_found + $(detect_bad_permissions \"$dir\")))\n    done\n    threats_found=$((threats_found + $(detect_suspicious_crons)))\n\n    if (( threats_found &gt; 0 )); then\n        IO:alert \"TOTAL THREATS FOUND: ${threats_found}\"\n        local summary=\"Host: $(hostname)\\nThreats: ${threats_found}\\nMode: ${mode}\"\n        send_notifications \"$summary\"\n        return 1\n    else\n        IO:success \"All clear - no threats detected\"\n        return 0\n    fi\n}\n</code></pre></p> <p>IMPORTANT pattern: Each detect_* function must echo (print to stdout) the count of threats found as its last output, since we capture it with <code>$(...)</code>. Use IO:alert (stderr) for messages, and echo the count to stdout. Alternatively, use a global variable or temp file. The cleanest approach: use a global <code>threats_found</code> variable incremented inside each detector (simpler, matches the original).</p> <p>Revised approach: Use a global variable <code>threats_found=0</code> in do_scan, and each detector increments it directly. Don't capture output.</p> <pre><code>function do_scan() {\n    threats_found=0  # global, incremented by detectors\n    # ... detect calls ...\n    detect_git_anomalies \"$dir\"\n    detect_webroot_injections \"$dir\"\n    # etc.\n}\n</code></pre>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#task-7-implement-do_install","title":"Task 7: Implement do_install()","text":"<pre><code>ADD do_install() function:\n  - Check running as root (or with sudo)\n  - Create /opt/forge-guardian/ and quarantine dir\n  - Copy script to /opt/forge-guardian/forge-guardian.sh\n  - chmod +x\n  - Create /var/log/forge-guardian.log\n  - Set up cron job (idempotent): */N * * * * forge-guardian.sh scan --mode &lt;mode&gt;\n  - Set up logrotate config\n  - Run initial dry-run scan\n</code></pre> <p>Pseudocode: <pre><code>function do_install() {\n    # Check if we can write to /opt\n    [[ ! -w /opt ]] &amp;&amp; IO:die \"Need root/sudo to install to /opt/forge-guardian/\"\n\n    local install_dir=\"/opt/forge-guardian\"\n    mkdir -p \"${install_dir}/quarantine\"\n\n    # Copy self\n    cp \"$script_install_path\" \"${install_dir}/forge-guardian.sh\"\n    chmod +x \"${install_dir}/forge-guardian.sh\"\n\n    # Copy .env if exists\n    [[ -f \"$script_install_folder/.env\" ]] &amp;&amp; \\\n        cp \"$script_install_folder/.env\" \"${install_dir}/.env\"\n\n    # Create log\n    touch /var/log/forge-guardian.log\n\n    # Cron job (idempotent)\n    local cron_cmd=\"*/${interval} * * * * ${install_dir}/forge-guardian.sh scan --mode ${mode} &gt;&gt; /var/log/forge-guardian.log 2&gt;&amp;1\"\n    (crontab -l 2&gt;/dev/null | grep -v 'forge-guardian' || true; echo \"$cron_cmd\") | crontab -\n    IO:success \"Cron job installed: every ${interval} minutes\"\n\n    # Logrotate\n    cat &gt; /etc/logrotate.d/forge-guardian &lt;&lt; 'LOGROTATE'\n/var/log/forge-guardian.log {\n    weekly\n    rotate 12\n    compress\n    missingok\n    notifempty\n}\nLOGROTATE\n    IO:success \"Logrotate configured\"\n\n    IO:success \"Forge Guardian installed to ${install_dir}\"\n    IO:print \"Running initial scan (dry-run)...\"\n    \"${install_dir}/forge-guardian.sh\" scan --mode dryrun -V || true\n}\n</code></pre></p>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#task-8-implement-do_deploy","title":"Task 8: Implement do_deploy()","text":"<pre><code>ADD do_deploy() function:\n  - Collect servers from ${server[@]} array and --servers file\n  - Validate at least 1 server specified\n  - For each server:\n    1. Test SSH connection\n    2. SCP forge-guardian.sh to remote /opt/forge-guardian/\n    3. SCP .env if exists\n    4. SSH: run forge-guardian.sh install remotely\n  - Report success/failure count\n\nADD ssh_cmd() helper - SSH with configured user/key/port\nADD scp_cmd() helper - SCP with configured user/key/port\n</code></pre> <p>Pseudocode: <pre><code>function ssh_cmd() {\n    local srv=\"$1\"; shift\n    ssh -o StrictHostKeyChecking=accept-new \\\n        -o ConnectTimeout=10 \\\n        -i \"$key\" -p \"$port\" \\\n        \"${user}@${srv}\" \"$@\"\n}\n\nfunction scp_cmd() {\n    local src=\"$1\" srv=\"$2\" dest=\"$3\"\n    scp -o StrictHostKeyChecking=accept-new \\\n        -o ConnectTimeout=10 \\\n        -i \"$key\" -P \"$port\" \\\n        \"$src\" \"${user}@${srv}:${dest}\"\n}\n\nfunction do_deploy() {\n    Os:require \"ssh\"\n    Os:require \"scp\"\n\n    # Collect servers\n    local -a all_servers=(\"${server[@]}\")\n\n    # Add servers from file\n    if [[ -n \"${servers:-}\" ]]; then\n        [[ ! -f \"$servers\" ]] &amp;&amp; IO:die \"Servers file not found: $servers\"\n        while IFS= read -r line; do\n            line=$(echo \"$line\" | sed 's/#.*//' | xargs)\n            [[ -n \"$line\" ]] &amp;&amp; all_servers+=(\"$line\")\n        done &lt; \"$servers\"\n    fi\n\n    [[ ${#all_servers[@]} -eq 0 ]] &amp;&amp; IO:die \"No servers specified. Use -s &lt;host&gt; or --servers &lt;file&gt;\"\n\n    IO:print \"Deploying to ${#all_servers[@]} server(s)\"\n\n    local succeeded=0 failed=0\n    for srv in \"${all_servers[@]}\"; do\n        IO:announce \"Deploying to ${user}@${srv}:${port}\"\n\n        # Test connection\n        if ! ssh_cmd \"$srv\" \"echo OK\" &amp;&gt;/dev/null; then\n            IO:alert \"Cannot SSH to $srv\"\n            ((failed++))\n            continue\n        fi\n        IO:debug \"SSH connection OK\"\n\n        # Upload\n        ssh_cmd \"$srv\" \"mkdir -p /opt/forge-guardian\"\n        scp_cmd \"$script_install_path\" \"$srv\" \"/opt/forge-guardian/forge-guardian.sh\"\n\n        # Upload .env if exists\n        if [[ -f \"$script_install_folder/.env\" ]]; then\n            scp_cmd \"$script_install_folder/.env\" \"$srv\" \"/opt/forge-guardian/.env\"\n        fi\n\n        # Remote install\n        ssh_cmd \"$srv\" \"/opt/forge-guardian/forge-guardian.sh install --mode ${mode} --interval ${interval}\"\n        IO:success \"Deployed to $srv\"\n        ((succeeded++))\n    done\n\n    IO:print \"Done: ${succeeded} succeeded, ${failed} failed\"\n    [[ $failed -eq 0 ]] || return 1\n}\n</code></pre></p>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#task-9-implement-do_uninstall","title":"Task 9: Implement do_uninstall()","text":"<pre><code>ADD do_uninstall() function:\n  - Remove cron entry\n  - Remove script (preserve quarantine if non-empty)\n  - Remove logrotate config\n  - Preserve log file\n</code></pre> <p>Pseudocode: <pre><code>function do_uninstall() {\n    IO:print \"Uninstalling Forge Guardian...\"\n\n    # Remove cron\n    (crontab -l 2&gt;/dev/null | grep -v 'forge-guardian' || true) | crontab -\n    IO:success \"Cron entry removed\"\n\n    # Remove files (preserve quarantine)\n    local install_dir=\"/opt/forge-guardian\"\n    if [[ -d \"${install_dir}/quarantine\" ]] &amp;&amp; [[ -n \"$(ls -A \"${install_dir}/quarantine\" 2&gt;/dev/null)\" ]]; then\n        IO:alert \"Preserving quarantine directory: ${install_dir}/quarantine/\"\n        rm -f \"${install_dir}/forge-guardian.sh\"\n        rm -f \"${install_dir}/.env\"\n    else\n        rm -rf \"${install_dir}\"\n    fi\n\n    rm -f /etc/logrotate.d/forge-guardian\n    IO:success \"Forge Guardian uninstalled\"\n    IO:print \"Log file preserved: /var/log/forge-guardian.log\"\n}\n</code></pre></p>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#task-10-update-envexample","title":"Task 10: Update .env.example","text":"<pre><code>MODIFY .env.example:\n  - Add all notification webhook variables\n  - Add scan mode and interval defaults\n  - Add SSH deploy defaults\n  - Add quarantine directory\n  - Add comments explaining each variable\n</code></pre>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#integration-points","title":"Integration Points","text":"<pre><code>CRON:\n  - install verb creates: \"*/5 * * * * /opt/forge-guardian/forge-guardian.sh scan --mode detect &gt;&gt; /var/log/forge-guardian.log 2&gt;&amp;1\"\n  - interval configurable via --interval option\n\nLOGROTATE:\n  - install verb creates: /etc/logrotate.d/forge-guardian\n\nSSH/SCP:\n  - deploy verb uses: ssh -i $key -p $port $user@$server\n  - deploy verb uses: scp -i $key -P $port\n\nENV:\n  - bashew auto-loads .env files (script folder + cwd)\n  - notification config in .env overridden by CLI flags\n  - deployed .env is copied to /opt/forge-guardian/.env on remote\n\nFILESYSTEM:\n  - /opt/forge-guardian/forge-guardian.sh     (installed script)\n  - /opt/forge-guardian/.env                  (config)\n  - /opt/forge-guardian/quarantine/           (quarantined files)\n  - /var/log/forge-guardian.log              (log output)\n  - /etc/logrotate.d/forge-guardian          (log rotation config)\n</code></pre>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#validation-loop","title":"Validation Loop","text":""},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#level-1-syntax-static-analysis","title":"Level 1: Syntax &amp; Static Analysis","text":"<pre><code># Syntax check\nbash -n forge-guardian.sh\n\n# ShellCheck (fix all warnings, add SC directives where needed)\nshellcheck forge-guardian.sh\n\n# Expected: No errors\n</code></pre>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#level-2-functional-tests","title":"Level 2: Functional Tests","text":"<pre><code># Test help output\n./forge-guardian.sh -h\n\n# Test check verb (shows all config values)\n./forge-guardian.sh check\n\n# Test env verb (generates .env template)\n./forge-guardian.sh env &gt; /tmp/test.env\n\n# Test scan verb fails gracefully when not on a Forge server\n./forge-guardian.sh scan 2&gt;&amp;1 || echo \"Expected: no projects found\"\n\n# Test deploy verb fails gracefully with no servers\n./forge-guardian.sh deploy 2&gt;&amp;1 || echo \"Expected: no servers specified\"\n\n# Test unknown action\n./forge-guardian.sh badaction 2&gt;&amp;1 || echo \"Expected: action not recognized\"\n</code></pre>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#level-3-integration-verification","title":"Level 3: Integration Verification","text":"<pre><code># Verify all verbs are listed in help\n./forge-guardian.sh -h | grep -E \"scan|install|deploy|uninstall\"\n\n# Verify .env loading works\necho 'slack=\"https://test\"' &gt; /tmp/test.env\n# (would need to test with actual .env in script folder)\n\n# Verify script can be sourced without executing (bashew feature)\nsource forge-guardian.sh  # should not execute Script:main\n</code></pre>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#final-validation-checklist","title":"Final Validation Checklist","text":"<ul> <li> <code>bash -n forge-guardian.sh</code> passes (syntax check)</li> <li> <code>shellcheck forge-guardian.sh</code> passes (or only acceptable SC directives)</li> <li> <code>./forge-guardian.sh -h</code> shows all verbs and options</li> <li> <code>./forge-guardian.sh check</code> shows all config values</li> <li> <code>./forge-guardian.sh scan</code> runs (fails gracefully if no $root/)</li> <li> <code>./forge-guardian.sh deploy</code> fails with helpful error when no servers given</li> <li> All 5 detectors from original are ported (git anomalies, webroot, recent changes, crons, permissions)</li> <li> All malicious signatures from original are included</li> <li> All suspicious filename patterns from original are included</li> <li> Notification functions support Slack, Discord, Telegram, Email</li> <li> .env.example documents all configurable variables</li> <li> No code modified below \"DO NOT MODIFY BELOW THIS LINE\" (line 172)</li> <li> TIP comments added for each verb</li> </ul>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#anti-patterns-to-avoid","title":"Anti-Patterns to Avoid","text":"<ul> <li>Do NOT modify bashew framework code below line 172</li> <li>Do NOT hardcode project directories \u2014 always auto-detect via <code>find</code></li> <li>Do NOT use <code>echo</code> for output \u2014 use <code>IO:print</code>, <code>IO:alert</code>, <code>IO:debug</code>, <code>IO:success</code></li> <li>Do NOT use <code>exit</code> directly \u2014 use <code>IO:die</code> or <code>return</code></li> <li>Do NOT use <code>$DRY_RUN</code> / <code>$AUTO_HEAL</code> booleans \u2014 use <code>$mode</code> (detect/heal/dryrun)</li> <li>Do NOT create separate scripts \u2014 everything goes in the single forge-guardian.sh</li> <li>Do NOT use backticks \u2014 use <code>$(command)</code> substitution</li> <li>Do NOT use unquoted variables \u2014 always <code>\"${var}\"</code></li> <li>Do NOT skip the <code># shellcheck disable=SCXXXX</code> directives where needed</li> <li>Do NOT forget that <code>IFS=$'\\n\\t'</code> is set (bashew strict mode) \u2014 word splitting works differently</li> </ul>"},{"location":"todo/PRPs/2026-02-11.implement-forge-guardian-bashew/#confidence-score-810","title":"Confidence Score: 8/10","text":"<p>Why 8 and not higher: - The scan detectors are well-documented in the original and straightforward to port - The bashew framework provides solid scaffolding - The <code>list</code> type for servers and .env for config are clean patterns - Risk areas: grep -P compatibility (macOS vs Linux), stat command differences, the IFS setting affecting array iteration in detection loops - The deploy verb has SSH complexity but follows a clear pattern from the original</p> <p>What could improve confidence: - Having a test server to validate SSH deploy - More specific tests for the detection functions - Handling edge cases around the <code>find $root</code> path on non-Forge systems</p>"}]}